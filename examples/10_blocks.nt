#!/usr/bin/env ntalk
#
# Blocks and closures
#

'=== Simple Blocks ===' println

block1 := [ 1 + 2 ]
('Block value: ' , (block1 value asString)) println

block2 := [ :x | x * 2 ]
('Double 5: ' , (block2 value: 5 asString)) println

block3 := [ :a :b | a + b ]
('Sum 3 + 4: ' , (block3 value: 3 value: 4 asString)) println

'' println
'=== Blocks with Temporaries ===' println

compute := [ :n |
  | squared doubled |
  squared := n * n
  doubled := n + n
  squared + doubled
]

('Compute with 5: ' , (compute value: 5 asString)) println

'' println
'=== Closures Capturing Variables ===' println

factor := 10
multiplier := [ :n | n * factor ]

('10 * 5 = ' , (multiplier value: 5 asString)) println

factor := 100
('100 * 5 = ' , (multiplier value: 5 asString)) println

'' println
'=== Returning from Blocks ===' println

findFirstPositive := [ :arr |
  arr do: [ :n |
    (n > 0) ifTrue: [ ^ n ]
  ].
  ^ nil
]

result := findFirstPositive value: #(-5 -3 7 2 8)
('First positive: ' , (result asString)) println
